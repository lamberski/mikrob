# Mikrob ðŸ¦ 

Ultralight website engine.

## Overview

Install the Composer package:

```bash
composer require lamberski/mikrob
```

Create `public/index.php` and paste:

```php
<?php

chdir('..');

require 'vendor/autoload.php';

print Mikrob\render_page();
```

Then start the server:

```bash
php -S localhost:8080 -t public
```

When opened in the browser, the script will automatically detect the page based on `$_SERVER['REQUEST_URI']`:

- localhost:8080 â†’ _pages/index.{json,php,md}_,
- localhost:8080/about â†’ _pages/about.{json,php,md}_.

`render_page()` accepts an optional parameter to explicitly tell it the page name:

```php
render_page('/contact'); // to render pages/contact.{json,php,md}
```

It's also possible to generate the page in CLI:

```bash
php index.php # to render page pages/index.php
php index.php --path=/terms # to render page pages/terms.{json,php,md}
```

## Pages

Pages are files located inside the _pages_ directory. The engine will look for one of three types of files â€” JSON, PHP, and Markdown. Each file represents one page with a path derived from the directory structure. _index.{json,php,md}_ files get special treatment of stripping away the "index" segment from the path.

| File                                         | Address           |
| -------------------------------------------- | ----------------- |
| _pages/blog/hello-world.{json,php,md}_       | /blog/hello-world |
| _pages/blog/hello-world/index.{json,php,md}_ | /blog/hello-world |
| _pages/blog/index.{json,php,md}_             | /blog             |
| _pages/blog/index/index.{json,php,md}_       | /blog             |

When Mikrob finds the file for a requested path, it will read its contents and pass it to the defined `view` template.

Page data is accessible in views as `$page`. If the page file contains the `"description"` field, it'll be accessible as `$page->description`.

### JSON

```json
{
  "view": "templates/product",
  "title": "Vacuum-o-matic 2000",
  "description": "Lorem ipsum dolor zamÄ™t.",
  "tags": ["hobby", "travel", "music"]
}
```

### PHP

This type is useful for making some calculations or data fetching before returning the data to view.

```php
<?php

return [
  'view' => 'page',
  'title' => 'Hello world!',
  'date' => '2019-03-07',
];
```

### Markdown

Each _\*.md_ file should consist of two parts â€” the front matter (JSON-based) and the page body written in Markdown. This format is intended for content-heavy pages and blog posts. The markdown part will be accessible in view as `$page->body`.

```md
---json
{
  "view": "post",
  "title": "My first post",
  "published": "2022-10-20"
}
---

This is content of my **first post**. It's nice.
```

### Custom page order and path

Pages are ordered alphabetically based on their path.

To customize the order, you can prefix the directory and file names with a number (or timestamp). Eg.

```
pages/
â””â”€â”€ blog/
    â”œâ”€â”€ 01-uno.md
    â””â”€â”€ 02-dos.md
```

But then, it becomes a part of the URL: _blog/01-uno.md_ would be accessible as /blog/01-uno.

To keep the URLs clean, you can overwrite the autogenerated path using the `path` field.

```json
{
  "path": "/blog/uno"
}
```

### Redirections

You can create a page that only redirects to another location by using the `redirect` field. This field takes two values: `destination`, which is the URL to redirect to, and `permanent`, which is a boolean indicating whether the redirection should be done with a 301 HTTP code.

```json
{
  "redirect": {
    "destination": "http://domain.com",
    "permanent": true,
  },
}
```

This would make the page accessible as /blog/uno.

## Views

Views are PHP files located inside the _views_ directory. They're referenced in pages as `view`.

```json
{
  "view": "templates/post"
}
```

Inside view files, you can define the HTML structure of your pages, sugar-coated with PHP code (like in the old days).

The main page view has the `$page` variable containing all the fields defined in the page file.

You can include other views (partials) using `load_view(string $path, array $data = [])`. The second parameter is useful for passing down any values necessary for the partial.

```php
<?= Mikrob\load_view('partials/header', ['title' => $page->title]) ?>
```

## Roadmap

- Site-wide data,
- RSS/Atom feed support.
